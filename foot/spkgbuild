# description	    : A fast, lightweight and minimalistic Wayland terminal emulator
# homepage	    : https://codeberg.org/dnkl/foot
# depends	    : fcft utf8proc libxkbcommon

name=foot
version=1.15.0
release=2
source="$name-$version.tar.gz::https://codeberg.org/dnkl/foot/archive/$version.tar.gz"

build() {

	export CFLAGS="$CFLAGS -O3" # -O3 as the package is intended to use it
	export CXXFLAGS="$CXXFLAGS -O3"
	export CPPFLAGS="$CPPFLAGS -O3"

	venom-meson $name-$version build \
		-Db_pgo=generate \
		-Dutmp-backend=none 
	meson compile -C build

	./pgo/full-headless-cage.sh . build

	meson configure -Db_pgo=use build
	meson compile -C build
	DESTDIR=$PKG meson install --no-rebuild -C build

	mv $PKG/usr/share/terminfo/f/foot $PKG/usr/share/terminfo/f/foot-extra 
	mv $PKG/usr/share/terminfo/f/foot-direct $PKG/usr/share/terminfo/f/foot-extra-direct

	rm -r $PKG/usr/share/fish
	rm -r $PKG/usr/share/bash-completion
	rm -r $PKG/usr/share/zsh
}
